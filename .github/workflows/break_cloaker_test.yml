name: üõ°Ô∏è Quebra Cloaker (Manual)

on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL do Cloaker/VSL (com http/https)'
        required: true
        type: string
      device:
        description: 'Dispositivo'
        required: true
        default: 'desktop_win'
        type: choice
        options:
          - desktop_win
          - desktop_mac
          - android
          - iphone
      country:
        description: 'Simular Pa√≠s (Proxy)'
        required: true
        default: 'us'
        type: choice
        options:
          - us
          - br
          - fr
          - de

jobs:
  breaker-direct:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      # Passando os inputs do usu√°rio para vari√°veis de ambiente
      INPUT_URL: ${{ inputs.target_url }}
      INPUT_DEVICE: ${{ inputs.device }}
      INPUT_COUNTRY: ${{ inputs.country }}

    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Instalar Depend√™ncias
        run: npm install
        
      - name: Instalar Navegadores
        run: npx playwright install chromium
        
      - name: üõ°Ô∏è EXECUTAR QUEBRA CLOAKER
        run: node cloaker_worker.mjs
