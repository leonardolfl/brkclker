name: üõ°Ô∏è Quebra Cloaker (Full Options)

on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL do Cloaker/VSL'
        required: true
        type: string
      device:
        description: 'Dispositivo'
        required: true
        default: 'android'
        type: choice
        options:
          - android
          - iphone
          - desktop_win
          - desktop_mac
      referer:
        description: 'Origem (Referer)'
        required: true
        default: 'facebook'
        type: choice
        options:
          - facebook
          - instagram
          - google
          - tiktok
          - youtube
          - direct
      language:
        description: 'Idioma'
        required: true
        default: 'pt-BR'
        type: choice
        options:
          - pt-BR
          - en-US
          - es-ES
          - fr-FR
          - de-DE
          - it-IT
      country:
        description: 'Pa√≠s (Proxy)'
        required: true
        default: 'us'
        type: choice
        options:
          - us
          - br
          - fr
          - de
          - it
          - co

jobs:
  breaker-full:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      # Secrets de Proxy (opcionais)
      PROXY_BR: ${{ secrets.PROXY_BR }}
      # Inputs
      INPUT_URL: ${{ inputs.target_url }}
      INPUT_DEVICE: ${{ inputs.device }}
      INPUT_REFERER: ${{ inputs.referer }}
      INPUT_LANGUAGE: ${{ inputs.language }}
      INPUT_COUNTRY: ${{ inputs.country }}

    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Instalar Depend√™ncias
        run: npm install
        
      - name: Instalar Navegadores
        run: npx playwright install chromium
        
      - name: üõ°Ô∏è EXECUTAR
        run: node cloaker_worker.mjs
