name: üõ°Ô∏è Quebra Cloaker (Pro)

on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'URL Alvo (http/https)'
        required: true
        type: string
      device:
        description: 'Dispositivo'
        required: true
        default: 'android'
        type: choice
        options:
          - android
          - iphone
          - desktop_win
          - desktop_mac
      referer:
        description: 'Simular Origem (Referer)'
        required: true
        default: 'facebook'
        type: choice
        options:
          - facebook
          - google
          - instagram
          - tiktok
          - youtube
          - direct (acesso direto)
      language:
        description: 'Idioma do Navegador'
        required: true
        default: 'pt-BR'
        type: choice
        options:
          - pt-BR (Portugu√™s)
          - en-US (Ingl√™s)
          - es-ES (Espanhol)
          - fr-FR (Franc√™s)
          - it-IT (Italiano)
          - de-DE (Alem√£o)
      country:
        description: 'Pa√≠s (Define Fuso Hor√°rio)'
        required: true
        default: 'br'
        type: choice
        options:
          - br (Brasil)
          - us (EUA)
          - fr (Fran√ßa)
          - it (It√°lia)
          - de (Alemanha)
          - co (Col√¥mbia)
          - cl (Chile)

jobs:
  breaker-pro:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      # Inputs
      INPUT_URL: ${{ inputs.target_url }}
      INPUT_DEVICE: ${{ inputs.device }}
      INPUT_REFERER: ${{ inputs.referer }}
      INPUT_LANGUAGE: ${{ inputs.language }}
      INPUT_COUNTRY: ${{ inputs.country }}

    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: Instalar Depend√™ncias
        run: npm install
        
      - name: Instalar Navegadores
        run: npx playwright install chromium
        
      - name: üõ°Ô∏è EXECUTAR VARREDURA
        run: node cloaker_worker.mjs
